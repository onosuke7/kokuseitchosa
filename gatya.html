<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚¬ãƒãƒ£å›½å‹¢èª¿æŸ»</title>
    <style>
        body { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            flex-direction: column; 
            min-height: 100vh; 
            margin: 0; 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
        }
        .container { 
            text-align: center; 
            background: rgba(255, 255, 255, 0.8); 
            padding: 5%; 
            border-radius: 1em; 
            box-shadow: 0 0 1.5em rgba(0, 0, 0, 0.2); 
            max-width: 90%; 
            margin: 2em;
        }
        .character, .enemy { 
            margin: 2%; 
            padding: 5%; 
            border: 0.2em solid black; 
            width: 90%; 
            box-sizing: border-box; 
            background: #ffffff; 
            border-radius: 1em; 
            transition: transform 0.3s;
        }
        .character:hover, .enemy:hover { 
            transform: scale(1.05); 
        }
        .item { 
            margin: 2%; 
            padding: 5%; 
            border: 0.2em solid blue; 
            display: inline-block; 
            background: #f0f8ff; 
            border-radius: 0.5em; 
            transition: background 0.3s;
        }
        .item:hover { 
            background: #add8e6; 
        }
        .rare10 { border-color: purple; }
        .rare5 { border-color: red; }
        .rare4 { border-color: orange; }
        .rare3 { border-color: yellow; }
        .rare2 { border-color: green; }
        .rare1 { border-color: blue; }
        .new { border-color: cyan; }
        .gacha-result { 
            display: flex; 
            justify-content: center; 
            flex-wrap: wrap; 
            margin-top: 2%; 
        }
        .gacha-anim { 
            display: none; 
            text-align: center; 
            font-size: 1.5em; 
            color: #ff4500; 
            animation: blink 1s infinite; 
        }
        .gacha-box { 
            width: 90%; 
            background-color: #f0f0f0; 
            margin: 2%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            box-sizing: border-box; 
            border-radius: 1em; 
            box-shadow: 0 0.4em 0.8em rgba(0, 0, 0, 0.1); 
        }
        button { 
            font-size: 1em; 
            padding: 1em 2em; 
            margin: 2%; 
            border: none; 
            border-radius: 0.5em; 
            background: #ff6f61; 
            color: white; 
            cursor: pointer; 
            transition: background 0.3s; 
        }
        button:hover { 
            background: #ff3b3b; 
        }
        .hp-bar { 
            background-color: #ddd; 
            border: 0.1em solid black; 
            width: 100%; 
            height: 2em; 
            position: relative; 
            border-radius: 1em; 
        }
        .hp-bar-fill { 
            background-color: green; 
            height: 100%; 
            width: 100%; 
            border-radius: 1em; 
            transition: width 0.5s; 
        }
        .item-list { 
            display: none; 
            flex-direction: column; 
            align-items: center; 
            margin-top: 2%; 
        }
        .player-item { 
            border: 0.2em solid blue; 
            background: #f0f8ff; 
            border-radius: 0.5em; 
            margin-bottom: 2%; 
        }
        .item-list .item { 
            margin: 2%; 
            padding: 5%; 
            border: 0.2em dashed blue; 
            background: #e6e6fa; 
            border-radius: 0.5em; 
        }
        #score { 
            position: fixed; 
            top: 1%; 
            font-size: 1.5em; 
            font-weight: bold; 
            color: red; /* ã‚¹ã‚³ã‚¢ã®è‰²ã‚’èµ¤ã«å¤‰æ›´ */
        }
        .instructions {
            margin-top: 2%;
            font-size: 1em;
            color: #333;
            background: #fff3cd;
            padding: 1em;
            border: 0.2em solid #ffeeba;
            border-radius: 0.5em;
            box-shadow: 0 0.4em 0.8em rgba(0, 0, 0, 0.1);
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        @media (max-width: 600px) {
            .container, .character, .enemy, .gacha-box, .item, .player-item {
                width: 100%;
                margin: 1em 0;
            }
            button {
                width: 100%;
                margin: 1em 0;
            }
        }
    </style>
    
</head>
<body>
    <div class="container">
        <h1>ã‚¬ãƒãƒ£å›½å‹¢èª¿æŸ»</h1>
        <p>è¿‘å¹´ã€å›½å‹¢èª¿æŸ»ã®å›ç­”ç‡ãŒä½ä¸‹ã—ã¦ã„ã‚‹ã“ã¨ãŒå•é¡Œã«ãªã£ã¦ã„ã¾ã™ã€‚å›½å‹¢èª¿æŸ»ã«å”åŠ›ã—ãªã„å›½æ°‘ãŒå¢—ãˆã¦ã„ã‚‹ãŸã‚ã€å›½æ°‘ã®åè«–ã‚’è·³ã­é™¤ã‘ã€ã‚ãªãŸã®é‹ã¨å®ŸåŠ›ã§å›½æ°‘ã‚’èª¬å¾—ã—ã¦ãã ã•ã„ã€‚</p>
        <p><a href="PDr.html">ã‚²ãƒ¼ãƒ ã®ãƒ«ãƒ¼ãƒ«ã‚’è¦‹ã‚‹</a></p>
        <div id="score">ã‚¹ã‚³ã‚¢: 0</div>
        <input type="text" id="gachaCount" placeholder="ã‚¬ãƒãƒ£ã®å›æ•° 1~15ï¼ˆåŠè§’ï¼‰">
        <button id="start" onclick="startGame()">ã‚¬ãƒãƒ£ã‚’å¼•ã</button>
        <div id="gachaAnim" class="gacha-anim">ğŸ‰ ã‚¬ãƒãƒ£ã‚’å¼•ã„ã¦ã„ã¾ã™... ğŸ‰</div>
        <div id="gachaResult" class="gacha-result"></div>
        <h2>é¸ã‚“ã èª¿æŸ»å“¡</h2>
        <div id="selectedCharacter"></div>
        <h2>ã‚¢ã‚¤ãƒ†ãƒ </h2>
        <div id="items"></div>
        <div class="item-list" id="itemList"></div>
        <button id="startBattle" onclick="startBattle()" style="display:none;">èª¿æŸ»é–‹å§‹</button>
        
        <div id="battle"></div>
        <button id="finish" onclick="attack()">èª¬å¾—ã™ã‚‹</button>
        <button id="gg" onclick="showItemList()">ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä½¿ç”¨</button>
        <div class="instructions">ãƒªã‚»ãƒƒãƒˆã—ãŸã„å ´åˆã¯Escapeã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
    </div>
    <h2>ä½œæˆãƒãƒ¼ãƒ ã®æœ€é«˜ã‚¹ã‚³ã‚¢:4898</h2>
    
    <p>ã‚¹ã‚³ã‚¢ã¯ã‚¢ã‚¤ãƒ†ãƒ ã®ä½¿ç”¨æ•°ã€èª¿æŸ»æ•°ã€ã‚¬ãƒãƒ£ã®å›æ•°ã«ã‚ˆã£ã¦åŠ ç®—ã•ã‚Œã¾ã™ã€‚</p>
    <a href="">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
    <script>
                const characters = [
            {name: 'æœ€å¼·èª¿æŸ»å“¡ ä½è—¤', rarity: 5, hp: 500, attack: 30},
            {name: 'æœ€å¼·èª¿æŸ»å“¡ å‰ç”°', rarity: 5, hp: 490, attack: 32},
            {name: 'æœ€å¼·èª¿æŸ»å“¡ æˆ¸ç”°', rarity: 5, hp: 510, attack: 27},
            {name: 'ã‚¨ãƒªãƒ¼ãƒˆèª¿æŸ»å“¡ ç”°ä¸­', rarity: 4, hp: 450, attack: 20},
            {name: 'ã‚¨ãƒªãƒ¼ãƒˆèª¿æŸ»å“¡ å±±å£', rarity: 4, hp: 455, attack: 22},
            {name: 'ã‚¨ãƒªãƒ¼ãƒˆèª¿æŸ»å“¡ åŸè¥¿', rarity: 4, hp: 460, attack: 24},
            {name: 'ã‚¨ãƒªãƒ¼ãƒˆèª¿æŸ»å“¡ æ·±ç”°', rarity: 4, hp: 445, attack: 23},
            {name: 'ã‚¨ãƒªãƒ¼ãƒˆèª¿æŸ»å“¡ ç«‹èŠ±', rarity: 4, hp: 450, attack: 21},
            {name: 'ã‚¨ãƒªãƒ¼ãƒˆèª¿æŸ»å“¡ æœ¬å¤š', rarity: 4, hp: 475, attack: 26},
            {name: 'ã‚¨ãƒªãƒ¼ãƒˆèª¿æŸ»å“¡ åŠ è—¤', rarity: 4, hp: 450, attack: 22},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ ç«¹ä¸­', rarity: 3, hp: 360, attack: 15},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ å®‰ç”°', rarity: 3, hp: 355, attack: 14},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ ä¹…ä¿ç”°', rarity: 3, hp: 360, attack: 13},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ å®‰è—¤', rarity: 3, hp: 365, attack: 16},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ æ¡‘åŸ', rarity: 3, hp: 358, attack: 14},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ å¹³å¡š', rarity: 3, hp: 362, attack: 15},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ åŒ—æ¡', rarity: 3, hp: 357, attack: 13},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ è°·', rarity: 3, hp: 359, attack: 14},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ æŸ´ç”°', rarity: 3, hp: 364, attack: 16},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ è¿‘è—¤', rarity: 3, hp: 356, attack: 13},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ å†…æ‘', rarity: 3, hp: 355, attack: 12},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ å³¶', rarity: 3, hp: 363, attack: 15},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ æœå€‰', rarity: 3, hp: 362, attack: 16},
            {name: 'ä¸Šç´šèª¿æŸ»å“¡ æ‘ç”°', rarity: 3, hp: 360, attack: 14},
            {name: 'ä¸€èˆ¬èª¿æŸ»å“¡ å±±å²¸', rarity: 2, hp: 300, attack: 10},
            {name: 'æ–°äººèª¿æŸ»å“¡ çŸ³å·', rarity: 1, hp: 220, attack: 5},
            {name: 'ãƒãƒ¼ãƒˆç´šèª¿æŸ»å“¡ å±±ï¨‘', rarity: 10, hp: 5000, attack: 79}
        ];

        const items = [
    {name: 'å›å¾©ãƒãƒ¼ã‚·ãƒ§ãƒ³', effect: 'hp', amount: 30},
    {name: 'èª¬å¾—åŠ›ã‚¢ãƒƒãƒ— (å°)', effect: 'attack', amount: 10},
    {name: 'èª¬å¾—åŠ›ã‚¢ãƒƒãƒ— (ä¸­)', effect: 'attack', amount: 15},
    {name: 'èª¬å¾—åŠ›ã‚¢ãƒƒãƒ— (å¤§)', effect: 'attack', amount: 20},
    {name: 'åè«–ç„¡åŠ¹ãƒãƒ¼ã‚·ãƒ§ãƒ³', effect: 'shield', amount: 1},
    {name: 'åè«–æ„æ¬²ä½ä¸‹ (å°)', effect: 'debuff', amount: 10},
    {name: 'åè«–æ„æ¬²ä½ä¸‹ (ä¸­)', effect: 'debuff', amount: 20},
    {name: 'åè«–æ„æ¬²ä½ä¸‹ (å¤§)', effect: 'debuff', amount: 30},
    {name: 'ãƒ¡ãƒ³ã‚¿ãƒ«å¢—åŠ ãƒãƒ¼ã‚·ãƒ§ãƒ³ (å°)', effect: 'maxHp', amount: 50},
    {name: 'ãƒ¡ãƒ³ã‚¿ãƒ«å¢—åŠ ãƒãƒ¼ã‚·ãƒ§ãƒ³ (ä¸­)', effect: 'maxHp', amount: 100},
    {name: 'ãƒ¡ãƒ³ã‚¿ãƒ«å¢—åŠ ãƒãƒ¼ã‚·ãƒ§ãƒ³ (å¤§)', effect: 'maxHp', amount: 150},
    {name: 'ç²¾ç¥åŠ›ã‚¢ãƒƒãƒ— (å°)', effect: 'defense', amount: 5},
    {name: 'ç²¾ç¥åŠ›ã‚¢ãƒƒãƒ— (ä¸­)', effect: 'defense', amount: 10},
    {name: 'ç²¾ç¥åŠ›ã‚¢ãƒƒãƒ— (å¤§)', effect: 'defense', amount: 15},
    {name: 'åè«–æ„æ¬²ãƒ€ã‚¦ãƒ³ (å°)', effect: 'enemyDebuff', amount: 5},
    {name: 'åè«–æ„æ¬²ãƒ€ã‚¦ãƒ³ (ä¸­)', effect: 'enemyDebuff', amount: 10},
    {name: 'åè«–æ„æ¬²ãƒ€ã‚¦ãƒ³ (å¤§)', effect: 'enemyDebuff', amount: 15}
];

const specialItems = [
    {name: 'å…¨å›å¾©ãƒãƒ¼ã‚·ãƒ§ãƒ³', effect: 'fullHeal', amount: 0},
    {name: 'å¼·åˆ¶æ•—åŒ—ã‚¢ã‚¤ãƒ†ãƒ ', effect: 'instantKill', amount: 0}
];


        const historicalFigures = ['æµ·æ–—', 'æ˜­è‹±', 'ç”±äº•', 'æ­¦å¼˜', 'ä½³å¥ˆç¾', 'ä¿¡ä¸€', 'æ‚ äºº', 'é›…ç¾', 'å”¯äºº', 'ã‚¸ãƒ§ãƒ¼ã‚¸'];

        let gachaResults = [];
        let selectedCharacter = null;
        let playerItems = [];
        let enemies = [];
        let currentEnemyIndex = 0;
        let gachaCount = 5;
        let itemUseCount = 0;
        let defeatedEnemies = 0;
        let totalEnemyHp = 0;
        let battleStarted = false;  // ãƒãƒˆãƒ«é–‹å§‹ãƒ•ãƒ©ã‚°

        function startGame() {
            const gachaInput = document.getElementById('gachaCount').value;
            if (gachaInput === 'EP-C4') {
                selectedCharacter = {name: 'ãƒãƒ¼ãƒˆç´šèª¿æŸ»å“¡ å±±ï¨‘', rarity: 10, hp: 5000, attack: 79, initialHp: 5000};
                const characterDiv = document.getElementById('selectedCharacter');
                characterDiv.innerHTML = `
                    èª¿æŸ»å“¡: ${selectedCharacter.name} (ãƒ¬ã‚¢ãƒªãƒ†ã‚£: ${selectedCharacter.rarity}, HP: ${selectedCharacter.hp}, æ”»æ’ƒåŠ›: ${selectedCharacter.attack})<br>
                    <div class="hp-bar"><div class="hp-bar-fill" style="width: 100%;"></div></div>
                `;
                // ç‰¹åˆ¥ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ 
                playerItems.push({name: 'å…¨å›å¾©ãƒãƒ¼ã‚·ãƒ§ãƒ³', effect: 'fullHeal', amount: 0});
                playerItems.push({name: 'å¼·åˆ¶æ•—åŒ—ã‚¢ã‚¤ãƒ†ãƒ ', effect: 'instantKill', amount: 0});
                displayItems();
                document.getElementById('startBattle').style.display = 'block';
                return;
            } else if (parseInt(gachaInput) >= 1 && parseInt(gachaInput) <= 15) {
                gachaCount = Math.min(Math.max(parseInt(gachaInput), 1), 15);
                drawGacha();
                document.getElementById("start").disabled = true;
            } else {
                alert('ã‚¬ãƒãƒ£ã®å›æ•°ã¯1ã‹ã‚‰15ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return ;
            }
        }

        function drawGacha() {
            gachaResults = [];
            document.getElementById('gachaAnim').style.display = 'block';
            document.getElementById('gachaResult').style.display = 'none';

            setTimeout(() => {
                while (gachaResults.length < gachaCount) {
                    const r = Math.random() * 100;
                    let gachaType;
                    if (r < 30) {
                        gachaType = 'item';
                    } else if (r < 35) {
                        gachaType = 'rarity5';
                    } else if (r < 45) {
                        gachaType = 'rarity4';
                    } else if (r < 70) {
                        gachaType = 'rarity3';
                    } else if (r < 90) {
                        gachaType = 'rarity2';
                    } else {
                        gachaType = 'rarity1';
                    }

                    let result;
                    if (gachaType === 'item') {
                        result = items[Math.floor(Math.random() * items.length)];
                    } else {
                        const filteredCharacters = characters.filter(c => c.rarity === parseInt(gachaType.replace('rarity', ''), 10));
                        result = filteredCharacters[Math.floor(Math.random() * filteredCharacters.length)];
                    }

                    gachaResults.push(result);
                }

                displayGachaResults();

                document.getElementById('gachaAnim').style.display = 'none';
                document.getElementById('gachaResult').style.display = 'flex';
                document.getElementById('startBattle').style.display = 'block';
            }, 2000);
        }

        function displayGachaResults() {
    const resultDiv = document.getElementById('gachaResult');
    resultDiv.innerHTML = '';
    gachaResults.forEach((result, index) => {
        const div = document.createElement('div');
        div.classList.add('gacha-box');
        if (result.hp) {
            if (result.rarity === 1) {
                div.classList.add('new'); // æ–°äººèª¿æŸ»å“¡ã®å ´åˆã®ã‚¯ãƒ©ã‚¹è¿½åŠ 
            } else {
                div.classList.add('character', `rare${result.rarity}`);
            }
            div.innerHTML = `èª¿æŸ»å“¡: ${result.name} (ãƒ¬ã‚¢ãƒªãƒ†ã‚£: ${result.rarity}, HP: ${result.hp}, æ”»æ’ƒåŠ›: ${result.attack})`;
            div.onclick = () => {
                if (!battleStarted) selectCharacter(result); // ãƒãƒˆãƒ«é–‹å§‹å¾Œã¯é¸æŠä¸å¯
            };
        } else {
            div.classList.add('item');
            div.innerHTML = `ã‚¢ã‚¤ãƒ†ãƒ : ${result.name} (${result.effect} +${result.amount})`;
            div.onclick = () => {
                if (!battleStarted) {
                    addItem(result);
                    div.onclick = null; // äºŒé‡ã‚¯ãƒªãƒƒã‚¯ã‚’é˜²æ­¢
                }
            };
        }
        resultDiv.appendChild(div);
    });
}


            function selectCharacter(character) {
                selectedCharacter = character;
                selectedCharacter.initialHp = character.hp; // initialHpã‚’ã‚»ãƒƒãƒˆ
                const characterDiv = document.getElementById('selectedCharacter');
                characterDiv.innerHTML = `
                    èª¿æŸ»å“¡: ${character.name} (ãƒ¬ã‚¢ãƒªãƒ†ã‚£: ${character.rarity}, ãƒ¡ãƒ³ã‚¿ãƒ«: ${character.hp}, èª¬å¾—åŠ›: ${character.attack})<br>
                    <div class="hp-bar"><div class="hp-bar-fill" style="width: 100%;"></div></div>
                `;
            }

            function addItem(item) {
                playerItems.push(item);
                displayItems();
            }

            function displayItems() {
                const itemsDiv = document.getElementById('items');
                itemsDiv.innerHTML = '';
                playerItems.forEach(item => {
                    const div = document.createElement('div');
                    div.classList.add('player-item'); // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æŒã£ã¦ã„ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã‚’åŒºåˆ¥
                    div.innerHTML = `ã‚¢ã‚¤ãƒ†ãƒ : ${item.name} (${item.effect} +${item.amount})`;
                    itemsDiv.appendChild(div);
                });
            }

            function startBattle() {
    battleStarted = true; // ãƒãƒˆãƒ«é–‹å§‹ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
    enemies = [];
    for (let i = 0; i < 5; i++) {
        let enemy = {
            name: historicalFigures[Math.floor(Math.random() * historicalFigures.length)],
            hp: Math.floor(Math.random() * 100) + 50,
            attack: Math.floor(Math.random() * 10) + 15
        };
        enemy.initialHp = enemy.hp; // initialHpã‚’ã‚»ãƒƒãƒˆ
        enemies.push(enemy);
    }
    currentEnemyIndex = 0;
    updateBattleStatus();
    
    // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠã‚’ç„¡åŠ¹åŒ–
    document.getElementById("startBattle").disabled = true;
    document.getElementById("gachaResult").style.pointerEvents = "none"; // ã‚¬ãƒãƒ£çµæœã®ç„¡åŠ¹åŒ–
    document.getElementById("start").disabled = true; // ã‚¬ãƒãƒ£ãƒœã‚¿ãƒ³ã‚‚ç„¡åŠ¹åŒ–
}

function attack() {
    if (!selectedCharacter) {
        alert('èª¿æŸ»å“¡ã‚’é¸ã‚“ã§ãã ã•ã„');
        return;
    }
    const enemy = enemies[currentEnemyIndex];
    if (selectedCharacter.shielded) {
        selectedCharacter.shielded = false;
        alert('åè«–ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸï¼');
    } else {
        enemy.hp -= selectedCharacter.attack;
        updateHpBar(enemy, 'enemy');
    }
    if (enemy.hp <= 0) {
        totalEnemyHp += enemy.initialHp; // totalEnemyHpã‚’åˆæœŸHPã§æ›´æ–°
        defeatedEnemies++;
        currentEnemyIndex++;
        if (currentEnemyIndex < enemies.length) {
            var messages = [
                "æœ€åˆã®å›½å‹¢èª¿æŸ»: æ—¥æœ¬ã§æœ€åˆã®å›½å‹¢èª¿æŸ»ã¯1872å¹´ã«è¡Œã‚ã‚Œã¾ã—ãŸã€‚",
                "èª¿æŸ»é »åº¦: æ—¥æœ¬ã§ã¯5å¹´ã”ã¨ã«å›½å‹¢èª¿æŸ»ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚",
                "èª¿æŸ»å¯¾è±¡: å›½å‹¢èª¿æŸ»ã¯å…¨å›½ã®ä½æ°‘ã‚’å¯¾è±¡ã«è¡Œã‚ã‚Œã€å¤–å›½äººã‚‚å«ã¾ã‚Œã¾ã™ã€‚",
                "å›ç­”ç¾©å‹™: å›½å‹¢èª¿æŸ»ã«ã¯æ³•çš„ãªå›ç­”ç¾©å‹™ãŒã‚ã‚Šã€å›ç­”ã—ãªã„å ´åˆã¯ç½°é‡‘ãŒç§‘ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚",
                "ãƒ‡ãƒ¼ã‚¿ã®åˆ©ç”¨: å›½å‹¢èª¿æŸ»ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€æ”¿ç­–ç«‹æ¡ˆã‚„çµŒæ¸ˆäºˆæ¸¬ãªã©ã«åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚",
                "èª¿æŸ»å†…å®¹: å›½å‹¢èª¿æŸ»ã§ã¯ã€äººå£ã€ä¸–å¸¯æ§‹æˆã€ä½å®…ã€æ•™è‚²ã€å°±æ¥­çŠ¶æ³ãªã©ãŒèª¿æŸ»ã•ã‚Œã¾ã™ã€‚",
                "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å›ç­”: æœ€è¿‘ã§ã¯ã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§å›½å‹¢èª¿æŸ»ã«å›ç­”ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã«ãªã£ã¦ã„ã¾ã™ã€‚",
                "èª¿æŸ»å“¡: å›½å‹¢èª¿æŸ»ã¯åœ°å…ƒã®èª¿æŸ»å“¡ãŒè¨ªå•ã—ã¦è¡Œã„ã¾ã™ã€‚",
                "æ­´å²çš„å¤‰é·: å›½å‹¢èª¿æŸ»ã®å†…å®¹ã‚„æ–¹æ³•ã¯ã€æ™‚ä»£ã¨å…±ã«å¤‰åŒ–ã—ã¦ãã¾ã—ãŸã€‚",
                "å›½éš›æ¯”è¼ƒ: å›½å‹¢èª¿æŸ»ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€å›½éš›çš„ãªæ¯”è¼ƒã«ã‚‚ä½¿ã‚ã‚Œã€ä¸–ç•Œã®äººå£å‹•æ…‹ã‚’ç†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚"
            ];
            var randomIndex = Math.floor(Math.random() * messages.length);
            var randomMessage = messages[randomIndex];
            alert(`${enemy.name} ãŒå›½å‹¢èª¿æŸ»ã«å”åŠ›ã—ã¾ã—ãŸã€‚æ¬¡ã®å›½æ°‘ã‚’è¨ªå•ã—ã¾ã™ã€‚å›½å‹¢èª¿æŸ»è±†çŸ¥è­˜: ${randomMessage}`);
        } else {
            let newEnemy = {
                name: historicalFigures[Math.floor(Math.random() * historicalFigures.length)],
                hp: Math.floor(Math.random() * 100) + 50,
                attack: Math.floor(Math.random() * 10) + 15
            };
            newEnemy.initialHp = newEnemy.hp; // initialHpã‚’ã‚»ãƒƒãƒˆ
            enemies.push(newEnemy);
            var messages = [
                "æœ€åˆã®å›½å‹¢èª¿æŸ»: æ—¥æœ¬ã§æœ€åˆã®å›½å‹¢èª¿æŸ»ã¯1872å¹´ã«è¡Œã‚ã‚Œã¾ã—ãŸã€‚",
                "èª¿æŸ»é »åº¦: æ—¥æœ¬ã§ã¯5å¹´ã”ã¨ã«å›½å‹¢èª¿æŸ»ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚",
                "èª¿æŸ»å¯¾è±¡: å›½å‹¢èª¿æŸ»ã¯å…¨å›½ã®ä½æ°‘ã‚’å¯¾è±¡ã«è¡Œã‚ã‚Œã€å¤–å›½äººã‚‚å«ã¾ã‚Œã¾ã™ã€‚",
                "å›ç­”ç¾©å‹™: å›½å‹¢èª¿æŸ»ã«ã¯æ³•çš„ãªå›ç­”ç¾©å‹™ãŒã‚ã‚Šã€å›ç­”ã—ãªã„å ´åˆã¯ç½°é‡‘ãŒç§‘ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚",
                "ãƒ‡ãƒ¼ã‚¿ã®åˆ©ç”¨: å›½å‹¢èª¿æŸ»ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€æ”¿ç­–ç«‹æ¡ˆã‚„çµŒæ¸ˆäºˆæ¸¬ãªã©ã«åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚",
                "èª¿æŸ»å†…å®¹: å›½å‹¢èª¿æŸ»ã§ã¯ã€äººå£ã€ä¸–å¸¯æ§‹æˆã€ä½å®…ã€æ•™è‚²ã€å°±æ¥­çŠ¶æ³ãªã©ãŒèª¿æŸ»ã•ã‚Œã¾ã™ã€‚",
                "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å›ç­”: æœ€è¿‘ã§ã¯ã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§å›½å‹¢èª¿æŸ»ã«å›ç­”ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã«ãªã£ã¦ã„ã¾ã™ã€‚",
                "èª¿æŸ»å“¡: å›½å‹¢èª¿æŸ»ã¯åœ°å…ƒã®èª¿æŸ»å“¡ãŒè¨ªå•ã—ã¦è¡Œã„ã¾ã™ã€‚",
                "æ­´å²çš„å¤‰é·: å›½å‹¢èª¿æŸ»ã®å†…å®¹ã‚„æ–¹æ³•ã¯ã€æ™‚ä»£ã¨å…±ã«å¤‰åŒ–ã—ã¦ãã¾ã—ãŸã€‚",
                "å›½éš›æ¯”è¼ƒ: å›½å‹¢èª¿æŸ»ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€å›½éš›çš„ãªæ¯”è¼ƒã«ã‚‚ä½¿ã‚ã‚Œã€ä¸–ç•Œã®äººå£å‹•æ…‹ã‚’ç†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚"
            ];
            var randomIndex = Math.floor(Math.random() * messages.length);
            var randomMessage = messages[randomIndex];
            alert(`${newEnemy.name} ãŒå›½å‹¢èª¿æŸ»ã«å”åŠ›ã—ã¾ã—ãŸã€‚æ¬¡ã®å›½æ°‘ã‚’è¨ªå•ã—ã¾ã™ã€‚å›½å‹¢èª¿æŸ»è±†çŸ¥è­˜: ${randomMessage}`);
        }
        updateBattleStatus();
    } else {
        enemyTurn();
    }
}

function enemyTurn() {
    const enemy = enemies[currentEnemyIndex];
    if (!selectedCharacter.shielded) {
        selectedCharacter.hp -= enemy.attack;
    } else {
        alert('æ”»æ’ƒãŒç„¡åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸï¼');
    }
    updateHpBar(selectedCharacter, 'character');
    if (selectedCharacter.hp <= 0) {
        alert('å›½å‹¢èª¿æŸ»ã®å”åŠ›ã‚’æ‹’ã¾ã‚Œã¾ã—ãŸ');
        document.getElementById("finish").disabled = true;
        document.getElementById("gg").disabled = true;

        displayScore();
    } else {
        updateBattleStatus();
    }
}

document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
        location.reload();
    }
});


        function selectCharacter(character) {
            selectedCharacter = character;
            selectedCharacter.initialHp = character.hp; // initialHpã‚’ã‚»ãƒƒãƒˆ
            const characterDiv = document.getElementById('selectedCharacter');
            characterDiv.innerHTML = `
                èª¿æŸ»å“¡: ${character.name} (ãƒ¬ã‚¢ãƒªãƒ†ã‚£: ${character.rarity}, ãƒ¡ãƒ³ã‚¿ãƒ«: ${character.hp}, èª¬å¾—åŠ›: ${character.attack})<br>
                <div class="hp-bar"><div class="hp-bar-fill" style="width: 100%;"></div></div>
            `;
        }

        function addItem(item) {
            playerItems.push(item);
            displayItems();
        }

        function displayItems() {
            const itemsDiv = document.getElementById('items');
            itemsDiv.innerHTML = '';
            playerItems.forEach(item => {
                const div = document.createElement('div');
                div.classList.add('player-item'); // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æŒã£ã¦ã„ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã‚’åŒºåˆ¥
                div.innerHTML = `ã‚¢ã‚¤ãƒ†ãƒ : ${item.name} (${item.effect} +${item.amount})`;
                itemsDiv.appendChild(div);
            });
        }

        function startBattle() {
            enemies = [];
            for (let i = 0; i < 5; i++) {
                let enemy = {
                    name: historicalFigures[Math.floor(Math.random() * historicalFigures.length)],
                    hp: Math.floor(Math.random() * 100) + 50,
                    attack: Math.floor(Math.random() * 10) + 15
                };
                enemy.initialHp = enemy.hp; // initialHpã‚’ã‚»ãƒƒãƒˆ
                enemies.push(enemy);
            }
            currentEnemyIndex = 0;
            updateBattleStatus();

            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠã¨ã‚¬ãƒãƒ£ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            document.querySelectorAll('.gacha-box').forEach(box => box.onclick = null);
            document.getElementById("startBattle").disabled = true;
            document.getElementById("start").disabled = true; 
            battleStarted = true; // ãƒãƒˆãƒ«é–‹å§‹ãƒ•ãƒ©ã‚°ã‚’ã‚»ãƒƒãƒˆ
        }

        function attack() {
            if (!selectedCharacter) {
                alert('èª¿æŸ»å“¡ã‚’é¸ã‚“ã§ãã ã•ã„');
                return;
            }
            const enemy = enemies[currentEnemyIndex];
            if (selectedCharacter.shielded) {
                selectedCharacter.shielded = false;
                alert('åè«–ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸï¼');
            } else {
                enemy.hp -= selectedCharacter.attack;
                updateHpBar(enemy, 'enemy');
            }
            if (enemy.hp <= 0) {
                totalEnemyHp += enemy.initialHp; // totalEnemyHpã‚’åˆæœŸHPã§æ›´æ–°
                defeatedEnemies++;
                currentEnemyIndex++;
                if (currentEnemyIndex < enemies.length) {
                    alert(`${enemy.name} ãŒå›½å‹¢èª¿æŸ»ã«å”åŠ›ã—ã¾ã—ãŸã€‚æ¬¡ã®å›½æ°‘ã‚’è¨ªå•ã—ã¾ã™ã€‚`);
                } else {
                    let newEnemy = {
                        name: historicalFigures[Math.floor(Math.random() * historicalFigures.length)],
                        hp: Math.floor(Math.random() * 100) + 50,
                        attack: Math.floor(Math.random() * 10) + 15
                    };
                    newEnemy.initialHp = newEnemy.hp; // initialHpã‚’ã‚»ãƒƒãƒˆ
                    enemies.push(newEnemy);
                    alert(`${enemy.name} ãŒå›½å‹¢èª¿æŸ»ã«å”åŠ›ã—ã¾ã—ãŸã€‚æ¬¡ã®å›½æ°‘ã‚’è¨ªå•ã—ã¾ã™ã€‚`);
                }
                updateBattleStatus();
            } else {
                enemyTurn();
            }
        }

        function enemyTurn() {
            const enemy = enemies[currentEnemyIndex];
            if (!selectedCharacter.shielded) {
                selectedCharacter.hp -= enemy.attack;
            } else {
                alert('æ”»æ’ƒãŒç„¡åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸï¼');
            }
            updateHpBar(selectedCharacter, 'character');
            if (selectedCharacter.hp <= 0) {
                alert('å›½å‹¢èª¿æŸ»ã®å”åŠ›ã‚’æ‹’ã¾ã‚Œã¾ã—ãŸ');
                document.getElementById("finish").disabled = true;
                document.getElementById("gg").disabled = true;

                displayScore();
            } else {
                updateBattleStatus();
            }
        }

        function showItemList() {
            const itemListDiv = document.getElementById('itemList');
            itemListDiv.innerHTML = '';
            playerItems.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('item');
                itemDiv.innerHTML = `ã‚¢ã‚¤ãƒ†ãƒ : ${item.name} (${item.effect} +${item.amount})`;
                itemDiv.onclick = () => useItem(index);
                itemListDiv.appendChild(itemDiv);
            });
            itemListDiv.style.display = 'flex';
        }

        function useItem(index) {
            const item = playerItems[index];
            playerItems.splice(index, 1); // ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
            document.getElementById('itemList').style.display = 'none';
            itemUseCount++; // ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            if (!selectedCharacter) {
                alert('èª¿æŸ»å“¡ã‚’é¸ã‚“ã§ãã ã•ã„');
                return;
            }
            if (item.effect === 'hp') {
                selectedCharacter.hp += item.amount;
                updateHpBar(selectedCharacter, 'character');
            } else if (item.effect === 'fullHeal') {
                selectedCharacter.hp = selectedCharacter.initialHp;
                updateHpBar(selectedCharacter, 'character');
            } else if (item.effect === 'attack') {
                selectedCharacter.attack += item.amount;
            } else if (item.effect === 'shield') {
                enemies[currentEnemyIndex].attack = 0;
                alert('ã“ã®å›½æ°‘ã®åè«–ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¾ã™ï¼');
            } else if (item.effect === 'debuff') {
                enemies[currentEnemyIndex].attack -= item.amount;
            } else if (item.effect === 'instantKill') {
                enemies[currentEnemyIndex].hp = 0;
                updateHpBar(enemies[currentEnemyIndex], 'enemy');
            } else if (item.effect === 'maxHp') {
                selectedCharacter.hp += item.amount;
                selectedCharacter.initialHp += item.amount; // initialHpã«ã‚‚åæ˜ 
                updateHpBar(selectedCharacter, 'character');
            } else if (item.effect === 'defense') {
                selectedCharacter.defense += item.amount;
                enemies[currentEnemyIndex].attack -= item.amount;
            } else if (item.effect === 'enemyDebuff') {
                enemies[currentEnemyIndex].attack -= item.amount;
            }
            displayItems();
            updateBattleStatus();
        }

        function updateHpBar(character, type) {
            const hpBarFill = type === 'character' ? document.querySelector('#selectedCharacter .hp-bar-fill') : document.querySelector('#battle .hp-bar-fill');
            if (hpBarFill) {
                hpBarFill.style.width = `${(character.hp / character.initialHp) * 100}%`;
            }
        }

        function updateBattleStatus() {
            const battleDiv = document.getElementById('battle');
            const enemy = enemies[currentEnemyIndex];
            battleDiv.innerHTML = `
                å›½æ°‘: ${enemy.name} (ãƒ¡ãƒ³ã‚¿ãƒ«: ${enemy.hp}, èª¬å¾—åŠ›: ${enemy.attack})<br>
                <div class="hp-bar"><div class="hp-bar-fill" style="width: ${(enemy.hp / enemy.initialHp) * 100}%;"></div></div>
                èª¿æŸ»å“¡: ${selectedCharacter.name} (ãƒ¡ãƒ³ã‚¿ãƒ«: ${selectedCharacter.hp}, æ”»æ’ƒåŠ›: ${selectedCharacter.attack})<br>
                <div class="hp-bar"><div class="hp-bar-fill" style="width: ${(selectedCharacter.hp / selectedCharacter.initialHp) * 100}%;"></div></div>
            `;

        }

        function displayScore() {
            const score = (itemUseCount * 6) + totalEnemyHp*3 + (defeatedEnemies * ((15 - gachaCount)*2));
            const scoreDiv = document.getElementById('score');
            scoreDiv.innerHTML = `ã‚¹ã‚³ã‚¢: ${score}`;
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                location.reload();
            }
        });
    </script>
</body>
</html>
